<!--
  How to customize:
  1) Place your images in an images/ folder next to this HTML (1.jpg..8.jpg).
  2) Update headlines/messages in the frames array below.
  3) Tune colors in :root as needed.
-->
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Mrs. Sandoval's Valentine Polaroids</title>
    <style>
      :root {
        color-scheme: light;
        --bg-1: #fff3f6;
        --bg-2: #ffe1ea;
        --viewer-red: #df314b;
        --viewer-pink: #ff8fb4;
        --viewer-deep: #8f1431;
        --viewer-cream: #ffe7ee;
        --text-dark: #2b0b18;
        --text-light: #fff8fb;
        --accent: #ff4d6d;
        --shadow: rgba(0, 0, 0, 0.2);
        --ring: rgba(255, 255, 255, 0.65);
        --radius: 22px;
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Trebuchet MS", "Verdana", "Arial Narrow", sans-serif;
        color: var(--text-dark);
        background:
          radial-gradient(circle at 15% 10%, rgba(255, 255, 255, 0.85), transparent 55%),
          radial-gradient(circle at 85% 0%, rgba(255, 206, 220, 0.6), transparent 60%),
          radial-gradient(circle at 20% 85%, rgba(255, 190, 210, 0.35), transparent 55%),
          linear-gradient(180deg, var(--bg-1), var(--bg-2));
        min-height: 100vh;
        padding: calc(env(safe-area-inset-top) + 16px)
          calc(env(safe-area-inset-right) + 16px)
          calc(env(safe-area-inset-bottom) + 16px)
          calc(env(safe-area-inset-left) + 16px);
        display: grid;
        place-items: start center;
        overscroll-behavior: none;
        -webkit-tap-highlight-color: transparent;
      }

      button,
      input,
      textarea {
        font: inherit;
      }

      button {
        border: none;
        border-radius: 999px;
        padding: 10px 16px;
        background: rgba(255, 255, 255, 0.94);
        color: #6b0f2c;
        font-weight: 700;
        letter-spacing: 0.6px;
        cursor: pointer;
        box-shadow:
          0 8px 16px rgba(0, 0, 0, 0.16),
          inset 0 2px 4px rgba(255, 255, 255, 0.8);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      button:hover {
        transform: translateY(-1px);
      }

      button:active {
        transform: translateY(0);
        box-shadow:
          0 4px 10px rgba(0, 0, 0, 0.2),
          inset 0 3px 6px rgba(255, 255, 255, 0.75);
      }

      .app {
        max-width: 980px;
        width: 100%;
        margin: 0 auto;
        display: grid;
        gap: 20px;
      }

      .app__header {
        text-align: center;
      }

      .app__header h1 {
        font-family: "Georgia", "Palatino Linotype", "Book Antiqua", serif;
        font-size: clamp(1.6rem, 5vw, 2.5rem);
        margin: 0 0 6px;
        letter-spacing: 0.5px;
      }

      .app__header p {
        margin: 0;
        font-size: clamp(0.95rem, 2.8vw, 1.1rem);
        opacity: 0.8;
      }

      .viewer {
        position: relative;
        background:
          radial-gradient(circle at 15% 15%, rgba(255, 255, 255, 0.75), transparent 60%),
          linear-gradient(160deg, #fff7fb, #ffe3ed);
        border: 2px solid rgba(255, 255, 255, 0.7);
        border-radius: clamp(24px, 4vw, 40px);
        padding: clamp(18px, 4vw, 34px);
        box-shadow:
          0 26px 46px rgba(0, 0, 0, 0.18),
          inset 0 4px 10px rgba(255, 255, 255, 0.45);
        display: grid;
        gap: clamp(12px, 2.6vw, 20px);
      }

      .polaroid-area {
        display: grid;
        place-items: center;
        position: relative;
        padding: 8px 0 4px;
        touch-action: pan-y;
        user-select: none;
        z-index: 1;
      }

      .polaroid-stack {
        position: relative;
        width: min(84vw, 420px);
        aspect-ratio: 4 / 5;
      }

      .polaroid-stack::before,
      .polaroid-stack::after {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 18px;
        background: #fff;
        box-shadow:
          0 18px 28px rgba(0, 0, 0, 0.18),
          inset 0 1px 2px rgba(255, 255, 255, 0.8);
        transform-origin: bottom center;
      }

      .polaroid-stack::before {
        transform: rotate(-4deg) translateY(8px);
        opacity: 0.55;
      }

      .polaroid-stack::after {
        transform: rotate(3deg) translateY(14px);
        opacity: 0.4;
      }

      .polaroid-card {
        position: relative;
        z-index: 1;
        background: #fff;
        border-radius: 18px;
        padding: 18px 18px 22px;
        box-shadow:
          0 22px 36px rgba(0, 0, 0, 0.22),
          inset 0 1px 2px rgba(255, 255, 255, 0.8);
        --shift: 14px;
        --tilt: -1.5deg;
        transform: rotate(var(--tilt));
        transition: box-shadow 0.3s ease;
      }

      .polaroid-card[data-direction="prev"] {
        --shift: -14px;
        --tilt: 1.5deg;
      }

      .polaroid-card.is-shifting {
        animation: polaroid-shift 0.42s ease;
      }

      @keyframes polaroid-shift {
        0% { transform: rotate(var(--tilt)) translateX(0) scale(1); }
        45% { transform: rotate(var(--tilt)) translateX(var(--shift)) scale(0.98); }
        100% { transform: rotate(var(--tilt)) translateX(0) scale(1); }
      }

      .polaroid-photo {
        position: relative;
        border-radius: 14px;
        overflow: hidden;
        aspect-ratio: 4 / 3;
        background:
          radial-gradient(circle at 25% 20%, rgba(255, 255, 255, 0.35), transparent 55%),
          linear-gradient(135deg, #f8dbe3, #e9a8ba);
        box-shadow:
          inset 0 8px 16px rgba(0, 0, 0, 0.2),
          0 12px 18px rgba(0, 0, 0, 0.2);
      }

      .polaroid-photo img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        display: block;
        background: #f7f1f4;
      }

      .polaroid-text {
        margin-top: 14px;
        min-height: 70px;
      }

      .polaroid-text h2 {
        margin: 0 0 6px;
        font-family: "Georgia", "Palatino Linotype", "Book Antiqua", serif;
        font-size: clamp(1.05rem, 3.2vw, 1.4rem);
        color: #3a0e1f;
      }

      .polaroid-text p {
        margin: 0;
        font-size: clamp(0.95rem, 2.5vw, 1.1rem);
        line-height: 1.35;
        color: #5a2436;
      }

      .polaroid-progress {
        position: absolute;
        top: 14px;
        right: 14px;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 0.72rem;
        letter-spacing: 0.12em;
        text-transform: uppercase;
        font-weight: 700;
        color: #fff;
        background: rgba(58, 14, 31, 0.7);
        backdrop-filter: blur(4px);
      }

      .loading-indicator {
        position: absolute;
        bottom: 10px;
        right: 12px;
        background: rgba(255, 255, 255, 0.9);
        color: #500c1f;
        padding: 6px 10px;
        border-radius: 999px;
        font-size: 0.8rem;
        display: none;
        z-index: 2;
      }

      .loading-indicator.show {
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .viewer__controls,
      .viewer__extras {
        display: grid;
        gap: 10px;
      }

      .viewer__controls {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      .viewer__controls button {
        text-transform: uppercase;
        font-size: 0.78rem;
        letter-spacing: 0.12em;
        background: rgba(255, 255, 255, 0.96);
      }

      .viewer__extras {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      .toggle {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        padding: 10px 14px;
        background: rgba(255, 255, 255, 0.92);
        border-radius: 999px;
        box-shadow:
          inset 0 2px 4px rgba(255, 255, 255, 0.8),
          0 8px 16px rgba(0, 0, 0, 0.12);
        font-weight: 600;
        color: #6b0f2c;
      }

      .toggle input {
        appearance: none;
        width: 44px;
        height: 24px;
        border-radius: 999px;
        background: #e5b9c5;
        position: relative;
        outline: none;
        cursor: pointer;
        transition: background 0.2s ease;
      }

      .toggle input::after {
        content: "";
        position: absolute;
        top: 3px;
        left: 3px;
        width: 18px;
        height: 18px;
        border-radius: 50%;
        background: #fff;
        box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
        transition: transform 0.2s ease;
      }

      .toggle input:checked {
        background: var(--accent);
      }

      .toggle input:checked::after {
        transform: translateX(20px);
      }


      .spotify {
        background: rgba(255, 255, 255, 0.94);
        border-radius: var(--radius);
        padding: 12px;
        box-shadow: 0 12px 22px rgba(0, 0, 0, 0.16);
        display: grid;
        gap: 6px;
      }

      .spotify h2 {
        margin: 0;
        font-size: clamp(1rem, 3vw, 1.3rem);
      }

      .spotify p {
        margin: 0 0 6px;
        font-size: clamp(0.85rem, 2.4vw, 1rem);
        opacity: 0.8;
      }

      .spotify iframe {
        width: 100%;
        border: 0;
        border-radius: 12px;
        height: 152px;
      }

      .overlay {
        position: absolute;
        inset: 0;
        display: grid;
        place-items: center;
        background: rgba(255, 233, 242, 0.95);
        border-radius: clamp(20px, 4vw, 40px);
        padding: 24px;
        backdrop-filter: blur(2px);
        z-index: 5;
      }

      .overlay[hidden] {
        display: none;
      }

      .overlay__card {
        background: #fff;
        border-radius: 24px;
        padding: clamp(18px, 4vw, 28px);
        text-align: center;
        box-shadow: 0 16px 30px rgba(0, 0, 0, 0.2);
        max-width: 420px;
      }

      .overlay__card h2 {
        margin: 0 0 8px;
        font-size: clamp(1.3rem, 4vw, 1.8rem);
      }

      .overlay__card p {
        margin: 0 0 18px;
      }

      .overlay__card button {
        min-width: 120px;
      }

      .end-actions {
        display: grid;
        gap: 10px;
      }

      .end-actions button {
        min-height: 44px;
        border-radius: 999px;
        border: none;
        background: var(--viewer-red);
        color: var(--text-light);
        font-weight: 700;
        cursor: pointer;
      }

      .end-actions .ghost {
        background: #fff;
        color: #6b0f2c;
      }

      .no-wiggle {
        position: relative;
        --wiggle-x: 0px;
        --wiggle-y: 0px;
      }

      .no-wiggle.wiggle {
        animation: wiggle 0.35s ease;
      }

      @keyframes wiggle {
        0% { transform: translate(var(--wiggle-x), var(--wiggle-y)) rotate(0deg); }
        35% { transform: translate(calc(var(--wiggle-x) - 6px), var(--wiggle-y)) rotate(-6deg); }
        70% { transform: translate(calc(var(--wiggle-x) + 6px), var(--wiggle-y)) rotate(6deg); }
        100% { transform: translate(var(--wiggle-x), var(--wiggle-y)) rotate(0deg); }
      }

      .confetti {
        position: fixed;
        inset: 0;
        pointer-events: none;
        z-index: 15;
      }

      .confetti-piece {
        position: absolute;
        width: 10px;
        height: 14px;
        border-radius: 2px;
        opacity: 0.9;
        animation: confetti-fall 2.2s ease-out forwards;
      }

      @keyframes confetti-fall {
        0% { transform: translateY(-10vh) rotate(0deg); opacity: 1; }
        100% { transform: translateY(110vh) rotate(360deg); opacity: 0; }
      }

      :focus-visible {
        outline: 3px solid var(--accent);
        outline-offset: 3px;
      }

      @media (min-width: 900px) {
        .viewer {
          grid-template-columns: minmax(0, 1fr);
          padding: clamp(22px, 3vw, 36px);
        }

        .polaroid-area { margin-top: -6px; }
        .polaroid-stack { width: min(420px, 60vw); }
      }

      @media (prefers-reduced-motion: reduce) {
        *, *::before, *::after {
          animation-duration: 0.001ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.001ms !important;
        }
      }
    </style>
  </head>
  <body>
    <main class="app">
      <header class="app__header">
        <h1>Valentine Polaroids</h1>
        <p>Swipe, click next, or use arrow keys to flip through the stack.</p>
      </header>

      <section class="viewer" aria-label="Valentine polaroid stack">
        <div class="polaroid-area" id="swipeArea">
          <div class="polaroid-stack">
            <div class="polaroid-card" id="polaroidCard">
              <span class="polaroid-progress" id="progress">0 / 0</span>
              <div class="polaroid-photo" role="img" aria-label="Photo viewing window">
                <img id="mainImage" alt="" />
              </div>
              <div class="polaroid-text" aria-live="polite">
                <h2 id="captionHeadline">Start the stack</h2>
                <p id="captionMessage">Tap "Start" to begin the show.</p>
              </div>
            </div>
          </div>
          <div class="loading-indicator" id="loadingIndicator" role="status" aria-live="polite">
            Loading...
          </div>
        </div>

        <div class="viewer__controls">
          <button id="prevBtn" aria-label="Previous photo">Back</button>
          <button id="nextBtn" aria-label="Next photo">Next</button>
        </div>

        <div class="viewer__extras">
          <label class="toggle" for="soundToggle">
            <input type="checkbox" id="soundToggle" />
            Sound
          </label>
          <label class="toggle" for="hapticToggle">
            <input type="checkbox" id="hapticToggle" />
            Haptic
          </label>
        </div>

        <div class="overlay" id="startOverlay">
          <div class="overlay__card">
            <h2>Start the stack</h2>
            <p>Tap to load the polaroids and start the Valentine story.</p>
            <button id="startBtn">Start</button>
          </div>
        </div>

        <div class="overlay" id="endOverlay" hidden>
          <div class="overlay__card">
            <h2>Will you be my Valentine?</h2>
            <p id="finalMessage">I have one last question for you.</p>
            <div class="end-actions">
              <button id="yesBtn">Yes!</button>
              <button id="noBtn" class="ghost no-wiggle">No</button>
              <button id="backBtn" class="ghost">Back</button>
              <button id="replayBtn" class="ghost">Replay</button>
            </div>
          </div>
        </div>
      </section>

      <section class="spotify" aria-label="Background song">
        <h2>Background song</h2>
        <p>Tap play to start (Hopefully this is one of your favorite Banda Songs).</p>
        <!-- Note: Spotify embeds require a connection and user interaction to start playback. -->
        <iframe
          data-testid="embed-iframe"
          src="https://open.spotify.com/embed/track/3EjuEvxoNgHV6urIdPA4cl?utm_source=generator"
          width="100%"
          height="152"
          frameborder="0"
          allowfullscreen=""
          allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"
          loading="lazy"
          title="Spotify player: track 3EjuEvxoNgHV6urIdPA4cl"
        ></iframe>
      </section>

    </main>

    <div class="confetti" id="confetti" aria-hidden="true"></div>

    <script>
      (() => {
        "use strict";

        const palette = [
          ["#ff6b6b", "#ffd6e0"],
          ["#ff8fab", "#ffe5ec"],
          ["#ffb3c1", "#ffe4e6"],
          ["#f7a8b8", "#ffd1dc"],
          ["#ff9aa2", "#ffdde1"],
          ["#ffb6b9", "#fae1dd"],
          ["#ffc3a0", "#ffd8be"],
          ["#ffcad4", "#fff0f3"],
          ["#fbc4ab", "#ffebd4"],
          ["#ffafcc", "#cdb4db"],
          ["#ffd1dc", "#c2f0fc"],
          ["#fcd5ce", "#f8edeb"],
        ];

        const makePlaceholder = (index, label, colors) => {
          const [c1, c2] = colors;
          const svg = `
            <svg xmlns="http://www.w3.org/2000/svg" width="900" height="700">
              <defs>
                <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
                  <stop offset="0%" stop-color="${c1}"/>
                  <stop offset="100%" stop-color="${c2}"/>
                </linearGradient>
              </defs>
              <rect width="100%" height="100%" fill="url(#g)"/>
              <circle cx="170" cy="150" r="90" fill="rgba(255,255,255,0.4)"/>
              <circle cx="740" cy="540" r="120" fill="rgba(255,255,255,0.35)"/>
              <text x="50%" y="52%" font-family="Trebuchet MS, Verdana, sans-serif"
                    font-size="54" text-anchor="middle" fill="rgba(80, 12, 31, 0.8)">
                Replace me ${String(index).padStart(2, "0")}
              </text>
              <text x="50%" y="62%" font-family="Trebuchet MS, Verdana, sans-serif"
                    font-size="26" text-anchor="middle" fill="rgba(80, 12, 31, 0.7)">
                ${label}
              </text>
            </svg>`;
          return `data:image/svg+xml;utf8,${encodeURIComponent(svg)}`;
        };

        const frames = [
          {
            src: "images/1.jpg",
            alt: "Photo 1",
            headline: "Hi Mrs. Sandoval!",
            message: "Ready for a quick story?",
          },
          {
            src: "images/2.jpg",
            alt: "Photo 2",
            headline: "You know I've always had my head in the clouds,",
            message: "for as long as I can remember.",
          },
          {
            src: "images/3.jpg",
            alt: "Photo 3",
            headline: "However deeply chaotic life got,",
            message: "It was always worth daydreaming and looking up.",
          },
          {
            src: "images/4.jpg",
            alt: "Photo 4",
            headline: "A possibility of how things could be.",
            message: "Maybe even a house with a view and my own little family to match.",
          },
          {
            src: "images/5.jpg",
            alt: "Photo 5",
            headline: "The one thing I could really keep and call my own,",
            message: "Not just something I'd give away like I usually do.",
          },
          {
            src: "images/6.jpg",
            alt: "Photo 6",
            headline: "You know what surprised me the most?",
            message: "How quickly that changed and my new favorite dream was of you.",
          },
          {
            src: "images/7.jpg",
            alt: "Photo 7",
            headline: "I dont know what brought you my way, Mrs. Sandoval,",
            message: "But, I'm so glad I got to know you.",
          },
          {
            src: "images/8.jpg",
            alt: "Photo 8",
            headline: "I'll always be your loudest cheerleader whether you know it or not,",
            message: "One last click before a big question...",
          },
        ];


        const elements = {
          polaroidCard: document.getElementById("polaroidCard"),
          mainImage: document.getElementById("mainImage"),
          captionHeadline: document.getElementById("captionHeadline"),
          captionMessage: document.getElementById("captionMessage"),
          progress: document.getElementById("progress"),
          startOverlay: document.getElementById("startOverlay"),
          endOverlay: document.getElementById("endOverlay"),
          loadingIndicator: document.getElementById("loadingIndicator"),
          prevBtn: document.getElementById("prevBtn"),
          nextBtn: document.getElementById("nextBtn"),
          startBtn: document.getElementById("startBtn"),
          yesBtn: document.getElementById("yesBtn"),
          noBtn: document.getElementById("noBtn"),
          backBtn: document.getElementById("backBtn"),
          replayBtn: document.getElementById("replayBtn"),
          finalMessage: document.getElementById("finalMessage"),
          confetti: document.getElementById("confetti"),
          soundToggle: document.getElementById("soundToggle"),
          hapticToggle: document.getElementById("hapticToggle"),
          swipeArea: document.getElementById("swipeArea"),
        };

        const prefersReduced = window.matchMedia("(prefers-reduced-motion: reduce)").matches;
        let currentIndex = -1;
        let audioContext;

        const updateCaption = () => {
          if (currentIndex < 0) {
            elements.captionHeadline.textContent = "Start the stack";
            elements.captionMessage.textContent = "Tap \"Start\" to begin the show.";
            elements.progress.textContent = `0 / ${frames.length}`;
            return;
          }
          if (currentIndex >= frames.length) {
            elements.progress.textContent = `${frames.length} / ${frames.length}`;
            return;
          }
          const frame = frames[currentIndex];
          elements.captionHeadline.textContent = frame.headline;
          elements.captionMessage.textContent = frame.message;
          elements.progress.textContent = `${currentIndex + 1} / ${frames.length}`;
        };

        const updateImage = () => {
          if (currentIndex < 0 || currentIndex >= frames.length) {
            elements.mainImage.removeAttribute("src");
            elements.mainImage.alt = "";
            return;
          }
          const frame = frames[currentIndex];
          elements.mainImage.src = frame.src;
          elements.mainImage.alt = frame.alt;
        };

        const showOverlay = (overlayEl, show) => {
          if (show) {
            overlayEl.removeAttribute("hidden");
          } else {
            overlayEl.setAttribute("hidden", "");
          }
        };

        const setIndex = (nextIndex) => {
          currentIndex = Math.max(-1, Math.min(nextIndex, frames.length));
          showOverlay(elements.startOverlay, currentIndex < 0);
          showOverlay(elements.endOverlay, currentIndex >= frames.length);
          updateImage();
          updateCaption();
        };

        const animatePolaroidShift = (direction) => {
          if (!elements.polaroidCard) return;
          elements.polaroidCard.dataset.direction = direction < 0 ? "prev" : "next";
          elements.polaroidCard.classList.remove("is-shifting");
          void elements.polaroidCard.offsetWidth;
          elements.polaroidCard.classList.add("is-shifting");
        };

        const playClickSound = () => {
          if (!elements.soundToggle.checked) return;
          if (!audioContext) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
          }
          if (audioContext.state === "suspended") {
            audioContext.resume();
          }
          const osc = audioContext.createOscillator();
          const gain = audioContext.createGain();
          osc.type = "square";
          osc.frequency.value = 720;
          gain.gain.value = 0.12;
          osc.connect(gain);
          gain.connect(audioContext.destination);
          osc.start();
          gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.08);
          osc.stop(audioContext.currentTime + 0.08);
        };

        const triggerHaptic = () => {
          if (!elements.hapticToggle.checked) return;
          if (navigator.vibrate) {
            navigator.vibrate(18);
          }
        };

        const advance = (direction) => {
          const next = currentIndex + direction;
          setIndex(next);
          animatePolaroidShift(direction);
          playClickSound();
          triggerHaptic();
        };

        const toStart = () => setIndex(0);
        const toPrev = () => advance(-1);
        const toNext = () => advance(1);

        const handleKeys = (event) => {
          const tag = event.target.tagName;
          if (tag === "INPUT" || tag === "TEXTAREA") return;
          if (event.key === "ArrowRight") {
            event.preventDefault();
            toNext();
          }
          if (event.key === "ArrowLeft") {
            event.preventDefault();
            toPrev();
          }
        };


        const preloadImages = async () => {
          if (!elements.loadingIndicator) return;
          elements.loadingIndicator.classList.add("show");
          let loaded = 0;
          const total = frames.length;
          await Promise.all(
            frames.map((frame) => {
              return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => {
                  loaded += 1;
                  elements.loadingIndicator.textContent = `Loading ${loaded} / ${total}`;
                  resolve();
                };
                img.onerror = () => {
                  loaded += 1;
                  elements.loadingIndicator.textContent = `Loading ${loaded} / ${total}`;
                  resolve();
                };
                img.src = frame.src;
              });
            })
          );
          elements.loadingIndicator.classList.remove("show");
        };






        const launchConfetti = () => {
          if (prefersReduced) return;
          const colors = ["#ff4d6d", "#ffd166", "#fca311", "#ffafcc", "#cdb4db"];
          const total = 36;
          elements.confetti.innerHTML = "";
          for (let i = 0; i < total; i += 1) {
            const piece = document.createElement("span");
            piece.className = "confetti-piece";
            piece.style.left = `${Math.random() * 100}%`;
            piece.style.background = colors[i % colors.length];
            piece.style.animationDelay = `${Math.random() * 0.4}s`;
            piece.style.transform = `translateY(-10vh) rotate(${Math.random() * 180}deg)`;
            elements.confetti.appendChild(piece);
          }
          setTimeout(() => {
            elements.confetti.innerHTML = "";
          }, 2400);
        };

        const wiggleNo = () => {
          const xShift = Math.round(Math.random() * 28 - 14);
          const yShift = Math.round(Math.random() * 18 - 9);
          elements.noBtn.style.setProperty("--wiggle-x", `${xShift}px`);
          elements.noBtn.style.setProperty("--wiggle-y", `${yShift}px`);
          elements.noBtn.classList.remove("wiggle");
          void elements.noBtn.offsetWidth;
          elements.noBtn.classList.add("wiggle");
        };

        const setupSwipe = () => {
          let startX = 0;
          let startY = 0;
          let isDown = false;

          const onDown = (event) => {
            isDown = true;
            startX = event.clientX;
            startY = event.clientY;
          };

          const onUp = (event) => {
            if (!isDown) return;
            isDown = false;
            const dx = event.clientX - startX;
            const dy = event.clientY - startY;
            if (Math.abs(dx) > 36 && Math.abs(dx) > Math.abs(dy)) {
              if (dx < 0) {
                toNext();
              } else {
                toPrev();
              }
            }
          };

          elements.swipeArea.addEventListener("pointerdown", onDown);
          elements.swipeArea.addEventListener("pointerup", onUp);
          elements.swipeArea.addEventListener("pointercancel", () => { isDown = false; });
        };

        const init = async () => {
          setIndex(-1);
          await preloadImages();
        };

        elements.startBtn.addEventListener("click", () => {
          toStart();
          animatePolaroidShift(1);
        });
        elements.nextBtn.addEventListener("click", toNext);
        elements.prevBtn.addEventListener("click", toPrev);
        elements.backBtn.addEventListener("click", () => {
          setIndex(frames.length - 1);
          animatePolaroidShift(-1);
        });
        elements.replayBtn.addEventListener("click", () => {
          setIndex(0);
          animatePolaroidShift(1);
        });
        elements.yesBtn.addEventListener("click", () => {
          launchConfetti();
          elements.finalMessage.textContent = "Yay! You just made my day.";
        });
        elements.noBtn.addEventListener("click", wiggleNo);
        document.addEventListener("keydown", handleKeys);
        setupSwipe();
        init();
      })();
    </script>
  </body>
</html>
